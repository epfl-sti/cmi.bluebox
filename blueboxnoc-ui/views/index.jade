extends layout

block jsheader
    script.
        var BlueboxNocApp = angular.module("BlueboxNocApp", ["ng-admin"]);
        // https://github.com/marmelab/ng-admin
        BlueboxNocApp.config(function (NgAdminConfigurationProvider, Application, Entity, Field, Reference, ReferencedList, ReferenceMany) {
            // set the main API endpoint for this admin
            var rootUrl = (location.protocol + '//' + location.hostname +
                (location.port ? ':' + location.port : ''));
            var app = new Application('BlueBoxAPI'). // application main title
                    baseApiUrl(rootUrl + "/api/"); // main API endpoint

            // define all entities at the top to allow references between them
            var vpn = new Entity('vpn')
                    .label("VPNs")
                    .identifier(new Field('title'));

            var bbx = new Entity('bbx')
                    .label("BBXs")
                    .identifier(new Field('title'));

            // set the application entities
            app
                .addEntity(vpn)
                .addEntity(bbx);

            // set the application menu entries
            vpn.menuView()
                    .order(1)
                    .icon('<span class="glyphicon glyphicon-unchecked"></span>');
            bbx.menuView()
                    .order(2)
                    .icon('<span class="glyphicon glyphicon-th"></span>');

            // VPNs
            vpn.dashboardView().title("VPNs List").fields([new Field("title").isDetailLink(true).label("VPN"), new Field("detail")]);
            vpn.editionView()
                    .title("Edit VPN {{entry.values.title}}")
                    .actions(["list", "show", "delete"])
                    .fields([
                        new Field("title").editable(false).isDetailLink(true),
                        new Field("detail"),
                        new ReferenceMany('bbxs') // a Reference is a particular type of field that references another entity
                                .targetEntity(bbx) // the tag entity is defined later in this file
                                .targetField(new Field('title')) // the field to be displayed in this list
                                // .cssClasses('css_bboxes') // Sadly this is not working on list view (issue https://github.com/marmelab/ng-admin/issues/309)
                    ]);
            vpn.listView()
                    .title("VPNs List")
                    .fields(vpn.editionView().fields());
            var titleAtCreationTime = new Field("title").validation({validator: !{VPNTitleValidator}});
            vpn.creationView().fields([
                titleAtCreationTime,
                new Field("detail")]);
            vpn.showView().fields([
                new Field("title").editable(false).isDetailLink(true),
                new Field("detail"),
                new Field("vpnBoxes").type("template").template('<div ng-controller="HelloWorld">Hello, {{user}}.</div>')
            ]);

            // BlueBoxes
            bbx.dashboardView().title("BlueBoxes List").fields([new Field("title").isDetailLink(true).label("BBX"), new Field("detail"), new Field("vpn")]);
            bbx.editionView().title("BBX {{entry.values.title}}")
                    .actions(["list", "show", "delete"])
                    .fields([
                        new Field("title").editable(false).isDetailLink(true),
                        new Field("vpn").editable(false),
                        new Field("detail")
                    ]);
            bbx.listView()
                    .title("BBXs List")
                    .fields(bbx.editionView().fields());
            var titleAtCreationTime = new Field("title").validation({validator: !{BBXTitleValidator}});
            bbx.creationView().fields([
                titleAtCreationTime,
                new Field("detail")]);
            bbx.showView().fields([
                new Field("title").editable(false).isDetailLink(true),
                new Field("detail"),
                new Field("vpn"),
                new Field("BBxVpn").type("template").template('<div ng-controller="HelloWorld">Hello, {{user}}.</div>')
            ]);

            NgAdminConfigurationProvider.configure(app);
        });

        // How to slap additional UI on any of the ng-admin pages,
        // e.g. here to access the VNC features
        BlueboxNocApp.controller("HelloWorld", function ($scope) {
            $scope.user = "Calvin Hobbes";
        });

block content
    img(src='../images/blueboxnoc100.png', class="logo", title="BlueBoxNocApp")
    h1
        a(href='#/dashboard') #{title}
    div(ui-view)

